
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Week 4: Build a theremin &#8212; The Data Science Labs on Fourier Analysis</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Week 5: The human experience of sound" href="../2_experiencing_sound.html" />
    <link rel="prev" title="Week 3: Build a synthesizer" href="../build_a_synthesizer/build_a_synthesizer.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Data Science Labs on Fourier Analysis</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    About This Course
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preliminaries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro_lab.html">
   Week 1: Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Synthesis
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1_play_sounds.html">
   Week 2: Playing Sound
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../build_a_synthesizer/build_a_synthesizer.html">
   Week 3: Build a synthesizer
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Week 4: Build a theremin
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2_experiencing_sound.html">
   Week 5: The human experience of sound
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Modulation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../modulation/am.html">
   Week 6: Tremolo/Beats Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../modulation/voice_changer_project.html">
   Week 7: Build a Voice Changer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../modulation/chirp.html">
   Week 8: Chirps and Bells
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3_sampling_and_reconstruction.html">
   Week 8: Finding the components of a measured signal
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dft.html">
   Week 9: Sampled Signal Analysis with the DFT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pedometer/pedometer_project.html">
   Week 10: Build a Pedometer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pedometer/pedo_frequency_project.html">
   Week 11: Step Detection versus Frequency Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../instruments.html">
   Week 13: Identifying Music Instruments
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../filtering.html">
   Week ?: Sampled Signal Filtering with the Circular Convolution
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Design a project of your own
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../final_project.html">
   Week 14-15: Final Project
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other Stuff- to be sorted
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../piano/labx.html">
   Build a piano
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2_Gait_Labs/7_Analysis/lab07.html">
   Week 8: Gait Analysis???
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/AldenMB/DSLab_Fourier/main?urlpath=tree/book/labs/build_a_theremin/build_a_theremin.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/AldenMB/DSLab_Fourier"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/AldenMB/DSLab_Fourier/issues/new?title=Issue%20on%20page%20%2Flabs/build_a_theremin/build_a_theremin.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/labs/build_a_theremin/build_a_theremin.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-00-content-span">
   <span style="color:orange;">
    00. Content
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mathematics">
     Mathematics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#programming-skills">
     Programming Skills
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#embedded-systems">
     Embedded Systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-0-required-hardware-span">
   <span style="color:orange;">
    0. Required Hardware
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-1-intro-span">
   <span style="color:orange;">
    1. Intro
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-2-the-components-span">
   <span style="color:orange;">
    2. The components
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-3-a-naive-approach-span">
   <span style="color:orange;">
    3. A naive approach
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-1-span-10-pts">
     <span style="color:red">
      Exercise 1
     </span>
     (10 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-4-faster-computation-span">
   <span style="color:orange;">
    4. faster computation
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-2-span-10-pts">
     <span style="color:red">
      Exercise 2
     </span>
     (10 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-5-finding-more-time-span">
   <span style="color:orange;">
    5. finding more time
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-3-span-10-pts">
     <span style="color:red">
      Exercise 3
     </span>
     (10 pts)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#understanding-the-asynchronous-version">
     Understanding the asynchronous version
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-4-span-30-pts">
     <span style="color:red">
      Exercise 4
     </span>
     (30 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-6-make-it-your-own-span">
   <span style="color:orange;">
    6. Make it your own
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-5-span-40-pts">
     <span style="color:red">
      Exercise 5
     </span>
     (40 pts)
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Week 4: Build a theremin</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-00-content-span">
   <span style="color:orange;">
    00. Content
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mathematics">
     Mathematics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#programming-skills">
     Programming Skills
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#embedded-systems">
     Embedded Systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-0-required-hardware-span">
   <span style="color:orange;">
    0. Required Hardware
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-1-intro-span">
   <span style="color:orange;">
    1. Intro
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-2-the-components-span">
   <span style="color:orange;">
    2. The components
   </span>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-3-a-naive-approach-span">
   <span style="color:orange;">
    3. A naive approach
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-1-span-10-pts">
     <span style="color:red">
      Exercise 1
     </span>
     (10 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-4-faster-computation-span">
   <span style="color:orange;">
    4. faster computation
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-2-span-10-pts">
     <span style="color:red">
      Exercise 2
     </span>
     (10 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-5-finding-more-time-span">
   <span style="color:orange;">
    5. finding more time
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-3-span-10-pts">
     <span style="color:red">
      Exercise 3
     </span>
     (10 pts)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#understanding-the-asynchronous-version">
     Understanding the asynchronous version
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-4-span-30-pts">
     <span style="color:red">
      Exercise 4
     </span>
     (30 pts)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#span-style-color-orange-6-make-it-your-own-span">
   <span style="color:orange;">
    6. Make it your own
   </span>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#span-style-color-red-exercise-5-span-40-pts">
     <span style="color:red">
      Exercise 5
     </span>
     (40 pts)
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="week-4-build-a-theremin">
<h1>Week 4: Build a theremin<a class="headerlink" href="#week-4-build-a-theremin" title="Permalink to this headline">#</a></h1>
<p><font size="6"> Laboratory ? </font> <br>
<font size="3"> Last updated August 18, 2022 </font></p>
<section id="span-style-color-orange-00-content-span">
<h2><span style="color:orange;"> 00. Content </span><a class="headerlink" href="#span-style-color-orange-00-content-span" title="Permalink to this headline">#</a></h2>
<section id="mathematics">
<h3>Mathematics<a class="headerlink" href="#mathematics" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>N/A</p></li>
</ul>
</section>
<section id="programming-skills">
<h3>Programming Skills<a class="headerlink" href="#programming-skills" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Asynchronous functions</p></li>
<li><p>Nonlocal variables</p></li>
</ul>
</section>
<section id="embedded-systems">
<h3>Embedded Systems<a class="headerlink" href="#embedded-systems" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Timing conflicts</p></li>
<li><p>Buffer underflow</p></li>
</ul>
</section>
</section>
<section id="span-style-color-orange-0-required-hardware-span">
<h2><span style="color:orange;"> 0. Required Hardware </span><a class="headerlink" href="#span-style-color-orange-0-required-hardware-span" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Raspberry Pi Pico</p></li>
<li><p>MicroUSB cable</p></li>
<li><p>Breadboard</p></li>
<li><p><a class="reference external" href="https://learn.adafruit.com/adafruit-max98357-i2s-class-d-mono-amp">I2S speaker module</a>, with <a class="reference external" href="https://www.adafruit.com/product/1890">8-ohm speaker</a> connected</p></li>
<li><p>jumper wires (at least 12)</p></li>
<li><p>a potentiometer</p></li>
</ul>
<h3 style="background-color:lightblue"> Write your name and email below: </h3>
<p><strong>Name:</strong> me</p>
<p><strong>Email:</strong> me &#64;purdue.edu</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-orange-1-intro-span">
<h2><span style="color:orange;"> 1. Intro </span><a class="headerlink" href="#span-style-color-orange-1-intro-span" title="Permalink to this headline">#</a></h2>
<p>In a previous lab, we made a synthesizer which works by playing precomputed samples of audio. That worked well for a synthesizer, where we only have a limited selection of notes to choose from. One of the main drawbacks of this approach is that we can’t change the samples in response to user input. For example, if we wanted to play sounds with multiple waveforms at multiple volumes over a continuous range of frequencies, we would run out of memory very fast.</p>
<p>In this lab, we will discover some of the problems with computing samples in real time, and share some strategies for overcoming those difficulties. This will culminate in building a musical instrument which you play without touching, called a theremin. A traditional theremin works by detecting changes in capacitance due to the presence of people, while ours will work by monitoring the timing of ultrasound signals.</p>
</section>
<section id="span-style-color-orange-2-the-components-span">
<h2><span style="color:orange;"> 2. The components </span><a class="headerlink" href="#span-style-color-orange-2-the-components-span" title="Permalink to this headline">#</a></h2>
<p>In the previous lab you tested the MAX98357 speaker module. As a reminder, it should be wired as in this table.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>MAX 98357</p></th>
<th class="head"><p>Speaker</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-</p></td>
<td><p>(either wire)</p></td>
</tr>
<tr class="row-odd"><td><p>+</p></td>
<td><p>(the other wire)</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>MAX 98357</p></th>
<th class="head"><p>Pico</p></th>
<th class="head"><p>What it does</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Vin</p></td>
<td><p>VBUS</p></td>
<td><p>USB power directly to the speaker driver</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>GND</p></td>
<td><p>A shared ground</p></td>
</tr>
<tr class="row-even"><td><p>BCLK</p></td>
<td><p>GP16</p></td>
<td><p>clock signal</p></td>
</tr>
<tr class="row-odd"><td><p>LRC</p></td>
<td><p>GP17</p></td>
<td><p>left/right channel select</p></td>
</tr>
<tr class="row-even"><td><p>DIN</p></td>
<td><p>GP18</p></td>
<td><p>data signal</p></td>
</tr>
</tbody>
</table>
<p>We will use two additional pieces of hardware today – an ultrasonic distance sensor, and a potentiometer. Connect them as in the following tables.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Potentiometer</p></th>
<th class="head"><p>Pico</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>left leg</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>right leg</p></td>
<td><p>3V3</p></td>
</tr>
<tr class="row-even"><td><p>wiper leg</p></td>
<td><p>GP26</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>HC-SR04</p></th>
<th class="head"><p>Pico</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VCC</p></td>
<td><p>VBUS</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-even"><td><p>Trig</p></td>
<td><p>GP19</p></td>
</tr>
<tr class="row-odd"><td><p>Echo</p></td>
<td><p>GP20</p></td>
</tr>
</tbody>
</table>
<p>There are many ways to accomplish these connections on a breadboard. One possible way is shown below – note that the breadboard power rails are used to provide power and ground to the potentiometer, and the ultrasonic sensor is connected to power at the speaker module.</p>
<p><img alt="a photo of a completed breadboard" src="../../_images/wiring_small.jpg" /></p>
<p>To test that you have everything connected correctly and your components are working as expected, the file <code class="docutils literal notranslate"><span class="pre">component_test.py</span></code> has been provided. When you run it, it should produce a stream of numbers. You should be able to change the first number by rotating the potentiometer. The second number should tell you the distance in centimeters from the ultrasonic distance sensor to the nearest hard flat object – if no object is detected it will give <code class="docutils literal notranslate"><span class="pre">nan</span></code> instead. If either number does not change, figure out why and fix it before continuing.</p>
</section>
<section id="span-style-color-orange-3-a-naive-approach-span">
<h2><span style="color:orange;"> 3. A naive approach </span><a class="headerlink" href="#span-style-color-orange-3-a-naive-approach-span" title="Permalink to this headline">#</a></h2>
<p>A theremin makes a pure tone with a frequency that changes from one input, and a volume which changes from the other input. A small distance corresponds to a high frequency or low volume, and a large distance makes a low tone or high volume.</p>
<p>Unfortunately, it can be hard to coordinate multiple ultrasonic sensors at once, since they can hear each other. For volume, we will use the potentiometer instead. The highest signal we can send to the speaker is <span class="math notranslate nohighlight">\(2^{15}\)</span> since it takes a signed 16 bit integer, and the potentiometer gives numbers between 0 and <span class="math notranslate nohighlight">\(2^{16}\)</span> since it’s an unsigned 16 bit integer. We will just take a sine curve and multiply it by the potentiometer value over 2.</p>
<p>Let’s set a high frequency of A5=880 Hz at 1 centimeter distance, and a low frequency of C4=262 Hz at 60 cm distance. That means at the high end a period of <span class="math notranslate nohighlight">\(\frac{22050}{880} = 25 \)</span> samples and at the low end a period of <span class="math notranslate nohighlight">\(\frac{22050}{262}=84\)</span> samples. For simplicity, we will interpolate linearly, giving the function</p>
<div class="math notranslate nohighlight">
\[
\text{sample count} = 25 + (84-25)\frac{\text{distance}-1}{60-1}.
\]</div>
<p>We will round to the nearest integer, giving us a curve like the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">sample_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span> <span class="mi">25</span> <span class="o">+</span> <span class="p">(</span><span class="mi">84</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">distance</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">sample_count</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/build_a_theremin_8_0.png" src="../../_images/build_a_theremin_8_0.png" />
</div>
</div>
<p>Applying this strategy blindly gives us a program like <code class="docutils literal notranslate"><span class="pre">naive_theremin.py</span></code>.</p>
<section id="span-style-color-red-exercise-1-span-10-pts">
<h3><span style="color:red"> Exercise 1 </span> (10 pts)<a class="headerlink" href="#span-style-color-red-exercise-1-span-10-pts" title="Permalink to this headline">#</a></h3>
<p>Run it and see what happens. You will likely find that it sounds scratchy, not at all like a pure sine wave, and of a much lower pitch than we would like. Write a description of the sound in your own words. How does it respond to movement in front of the ultrasonic sensor, or changes to the potentiometer?</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 1 Below </h3><p>The problem here is in timing. Run the program <code class="docutils literal notranslate"><span class="pre">naive_theremin_timed.py</span></code>. This is almost identical, but it notes the current time before and after computing the tone. You will find that the tone takes anywhere from 2500 to 8000 microseconds to make. A 50 sample clip only takes <span class="math notranslate nohighlight">\(\frac{50 \text{samples}}{22,050\text{ samples/second}}= 2200\)</span> microseconds to play. That means that by the time the the I2S buffer is empty, we have not even finished coming up with the next sample. This is called <strong>buffer underflow</strong>.</p>
<p>There are two ways to fix this. We can either compute the samples faster, or we can get ourselves more time to use for computing.</p>
</section>
</section>
<section id="span-style-color-orange-4-faster-computation-span">
<h2><span style="color:orange;"> 4. faster computation </span><a class="headerlink" href="#span-style-color-orange-4-faster-computation-span" title="Permalink to this headline">#</a></h2>
<p>If you want Python code to go faster, there is one approach which almost always works: remove big loops. There is just one big loop in the code which generates the tone. let’s try running that code on your computer. Your computer is much faster than the microcontroller, so it will be able to do it quicker, but we can still make useful comparisons by comparing with other code running on the same computer.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">timeit</span></code> command makes it easy to tell how long something takes to run. Let’s try it on the <code class="docutils literal notranslate"><span class="pre">make_tone</span></code> function. To make the effect more visible, we’ll make a tone with many more samples than we really need.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="k">def</span> <span class="nf">make_tone</span><span class="p">(</span><span class="n">samplecount</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
    <span class="n">tone</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">samplecount</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samplecount</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">volume</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">samplecount</span><span class="p">))</span>
        <span class="n">struct</span><span class="o">.</span><span class="n">pack_into</span><span class="p">(</span><span class="s2">&quot;&lt;h&quot;</span><span class="p">,</span> <span class="n">tone</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tone</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">make_tone</span><span class="p">(</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.85 ms ± 105 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>On my computer, it takes about 3.6 milliseconds to make a 6000-sample tone. Of course, I can do it without a loop if I just use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> instead. Let’s see how that would go.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fast_tone</span><span class="p">(</span><span class="n">samplecount</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
    <span class="n">tone</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">samplecount</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">fast_tone</span><span class="p">(</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>91 µs ± 2.51 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
</pre></div>
</div>
</div>
</div>
<p>On my computer that took just 91 microseconds, or 0.091 milliseconds. The difference is tremendous.</p>
<p>Can we get the same benefit in Micropython? Yes, but the default firmware does not include <code class="docutils literal notranslate"><span class="pre">numpy</span></code>. We will need to install a copy of the firmware which has that package available. You could download the latest version <a class="reference external" href="https://github.com/v923z/micropython-builder">from this website</a>, or just use the version included here as <code class="docutils literal notranslate"><span class="pre">PICO.uf2</span></code>. In either case, hold the bootloader button on your Pico while plugging it in, then copy the <code class="docutils literal notranslate"><span class="pre">uf2</span></code> file onto the drive that appears. Don’t use Thonny for this, since it will use the default firmware, not one which includes <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p>
<section id="span-style-color-red-exercise-2-span-10-pts">
<h3><span style="color:red"> Exercise 2 </span> (10 pts)<a class="headerlink" href="#span-style-color-red-exercise-2-span-10-pts" title="Permalink to this headline">#</a></h3>
<p>Run the file <code class="docutils literal notranslate"><span class="pre">numpy_theremin.py</span></code>. Write a description of the sound it makes, including in what ways it is different from the sound produced by <code class="docutils literal notranslate"><span class="pre">naive_theremin.py</span></code>.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 2 Below </h3><p>The only difference between the two files is the function <code class="docutils literal notranslate"><span class="pre">make_tone</span></code>, which has been swapped for the function <code class="docutils literal notranslate"><span class="pre">fast_tone</span></code> above. You will find it takes only around 800 microseconds to compute the tone now, easily 5 times faster. On top of that, we get the improved readability that code written with broadcasting provides.</p>
<p>Unfortunately, while it is faster, it is still not fast enough. We need to get some more time in order to make this work without buffer underflow.</p>
</section>
</section>
<section id="span-style-color-orange-5-finding-more-time-span">
<h2><span style="color:orange;"> 5. finding more time </span><a class="headerlink" href="#span-style-color-orange-5-finding-more-time-span" title="Permalink to this headline">#</a></h2>
<p>The code we have written so far is written in a synchronous way. Execution proceeds from top to bottom, doing one line at a time. For every call to <code class="docutils literal notranslate"><span class="pre">audio_out.write</span></code>, there is one call to <code class="docutils literal notranslate"><span class="pre">make_tone</span></code>. While the code does one thing (making the tone to play) it cannot do anything else (writing the tone to the buffer). This works fine as long as there is plenty of time to go around. In our case, it means there is a problem.</p>
<p>The simplest way to solve this would be to change the ratio of calls to <code class="docutils literal notranslate"><span class="pre">audio_out.write</span></code> and <code class="docutils literal notranslate"><span class="pre">make_tone</span></code>, carefully including more of one or the other, and tweaking the size of the I2S buffer until we find the perfect balance. That would be tedious, and it would be hard to change. If we rewrote some code to make one part faster, we would have to rewrite the whole thing.</p>
<p>The solution is to use <strong>asynchronous functions</strong>. An asynchronous function is called by a routine which schedules tasks according to whichever needs the time most urgently. If you run the program <code class="docutils literal notranslate"><span class="pre">async_theremin.py</span></code>, you will find it works great, with none of the clicking, stuttering, or scratching we heard previously.</p>
<section id="span-style-color-red-exercise-3-span-10-pts">
<h3><span style="color:red"> Exercise 3 </span> (10 pts)<a class="headerlink" href="#span-style-color-red-exercise-3-span-10-pts" title="Permalink to this headline">#</a></h3>
<p>Run the file <code class="docutils literal notranslate"><span class="pre">async_theremin.py</span></code>. Have some fun making spooky sounds. Just for fun, try to recreate the theremin intro sound from the original Star Trek. Once you have got it working, write a short message here to indicate that you have done so.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 3 Below </h3></section>
<section id="understanding-the-asynchronous-version">
<h3>Understanding the asynchronous version<a class="headerlink" href="#understanding-the-asynchronous-version" title="Permalink to this headline">#</a></h3>
<p>Most of the code here is the same as before. There are a few differences, which we will discuss here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tone</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">write_tone</span><span class="p">():</span>
    <span class="k">nonlocal</span> <span class="n">tone</span>
    <span class="c1"># ...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">refresh_tone</span><span class="p">():</span>
    <span class="k">nonlocal</span> <span class="n">tone</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The point of the asynchronous version is to allow these two routines (getting a new tone, and writing the current tone) to run independently of one another. However, they still need a way to share information between each other. That’s the point of the variable <code class="docutils literal notranslate"><span class="pre">tone</span></code>. By declaring it as <code class="docutils literal notranslate"><span class="pre">nonlocal</span></code>, we can have <code class="docutils literal notranslate"><span class="pre">refresh_tone</span></code> write to the variable and <code class="docutils literal notranslate"><span class="pre">write_tone</span></code> read from the variable.</p>
<p>Functions which run asynchronously need the special keyword <code class="docutils literal notranslate"><span class="pre">async</span></code> as part of their definition. This makes sure they are only called by asynchronous functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">swriter</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">audio_out</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">swriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tone</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">swriter</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>
</pre></div>
</div>
<p>All the hard work of managing the buffer is done by the <code class="docutils literal notranslate"><span class="pre">StreamWriter</span></code> object. We make a new <code class="docutils literal notranslate"><span class="pre">StreamWriter</span></code>, and write the tone to it. The special keyword <code class="docutils literal notranslate"><span class="pre">await</span></code> lets the interpreter go do other things until the condition it requires is met. In this case, the <code class="docutils literal notranslate"><span class="pre">drain</span></code> condition waits until there is enough room in the buffer to write the tone again.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Most of the body of <code class="docutils literal notranslate"><span class="pre">refresh_tone</span></code> is exactly the same as before. The only things we have added are the <code class="docutils literal notranslate"><span class="pre">nonlocal</span> <span class="pre">tone</span></code> statement and the line <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">asyncio.sleep(0.01)</span></code>. We have already explained what <code class="docutils literal notranslate"><span class="pre">nonlocal</span> <span class="pre">tone</span></code> does. The <code class="docutils literal notranslate"><span class="pre">await</span></code> statement here is not waiting for anything in particular to change, it’s just waiting for a certain amount of time to pass. This gives time to the <code class="docutils literal notranslate"><span class="pre">write_tone</span></code> function to run. It’s an added bonus that this keeps the tone generation loop from happening too frequently. We really won’t move our hands fast enough for changes in less than a hundredth of a second to matter, and this lets the whole system do less work.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">write_tone</span><span class="p">(),</span> <span class="n">refresh_tone</span><span class="p">()))</span>
</pre></div>
</div>
<p>This is the final change we made. This is where the asynchronous functions actually get run. <code class="docutils literal notranslate"><span class="pre">gather</span></code> combines the two tasks into one big task, and <code class="docutils literal notranslate"><span class="pre">asyncio.run</span></code> sets them both in motion. Since they both have <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> loops in them, they will keep going forever (until you tell them to stop).</p>
<p>This system works so well because it allows <code class="docutils literal notranslate"><span class="pre">write_tone</span></code> to be called as many times as necessary to fill the I2S buffer, running the <code class="docutils literal notranslate"><span class="pre">refresh_tone</span></code> function only as often as needed. Because the buffer stays topped off, there is always enough time to compute the tone when we need it. All the load balancing is handled by the <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> module!</p>
</section>
<section id="span-style-color-red-exercise-4-span-30-pts">
<h3><span style="color:red"> Exercise 4 </span> (30 pts)<a class="headerlink" href="#span-style-color-red-exercise-4-span-30-pts" title="Permalink to this headline">#</a></h3>
<p>Make two more nonlocal variables which (respectively) count how many times <code class="docutils literal notranslate"><span class="pre">write_tone</span></code> and <code class="docutils literal notranslate"><span class="pre">refresh_tone</span></code> are called. Put a line into each of the existing functions which increases their corresponding variable by 1 every time they go. Make a third asyncronous function which runs every two seconds and prints out the number of times each of the other tasks is run. Copy your code here, and comment on the results. About how many times is <code class="docutils literal notranslate"><span class="pre">write_tone</span></code> called for every time <code class="docutils literal notranslate"><span class="pre">refresh_tone</span></code> is called?</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Below </h3></section>
</section>
<section id="span-style-color-orange-6-make-it-your-own-span">
<h2><span style="color:orange;"> 6. Make it your own </span><a class="headerlink" href="#span-style-color-orange-6-make-it-your-own-span" title="Permalink to this headline">#</a></h2>
<p>What changes could you make to improve this theremin? Here are a few ideas:</p>
<ol class="simple">
<li><p>Get it working with a second ultrasonic sensor, for a truly hands-free experience</p></li>
<li><p>If you listen very carefully, you may notice the theremin stepping between tones as we go from one sample count to the next. You can see why this happens by considering the graph in section 3. Find a way to get a smoother transition between tones, possibly by including more cycles in each audio clip.</p></li>
<li><p>Add another dial to control the volume of a triangle wave of the same frequency, and add the sine and triangle waves together. This gives you control of the waveform in addition to the volume and pitch, making a whole new range of sounds possible.</p></li>
</ol>
<section id="span-style-color-red-exercise-5-span-40-pts">
<h3><span style="color:red"> Exercise 5 </span> (40 pts)<a class="headerlink" href="#span-style-color-red-exercise-5-span-40-pts" title="Permalink to this headline">#</a></h3>
<p>Pick an improvement from the list above, or think of a different improvement you could make. Describe how you made your improvement, including any code you wrote.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 5 Below </h3></section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs/build_a_theremin"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../build_a_synthesizer/build_a_synthesizer.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Week 3: Build a synthesizer</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../2_experiencing_sound.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Week 5: The human experience of sound</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mireille Boutin, Alden Bradford<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>